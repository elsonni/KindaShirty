<!-- /partials/scripts.html -->
<script src="/js/site.js" defer></script>

<script>
(function(){
  const ready = (fn) => (document.readyState.match(/loaded|interactive|complete/))
    ? setTimeout(fn,0) : document.addEventListener('DOMContentLoaded', fn);

  ready(() => {
    function initMobileNav(){
      const btn = document.getElementById('hamburger');
      const menu = document.getElementById('mobileNav');
      const overlay = document.getElementById('navOverlay');
      if(!btn || !menu) return false;

      const open = () => {
        menu.classList.remove('hidden');
        menu.setAttribute('aria-hidden','false');
        btn.setAttribute('aria-expanded','true');
        document.body.classList.add('no-scroll');
        overlay && overlay.classList.remove('hidden');
      };
      const close = () => {
        menu.classList.add('hidden');
        menu.setAttribute('aria-hidden','true');
        btn.setAttribute('aria-expanded','false');
        document.body.classList.remove('no-scroll');
        overlay && overlay.classList.add('hidden');
        btn.focus();
      };

      btn.addEventListener('click', () => menu.classList.contains('hidden') ? open() : close());
      overlay && overlay.addEventListener('click', close);
      document.addEventListener('keydown', (e) => { if(e.key === 'Escape') close(); });
      menu.querySelectorAll('a').forEach(a => a.addEventListener('click', close));
      return true;
    }

    if(!initMobileNav()){
      // If header is injected later, try again when DOM changes.
      const obs = new MutationObserver(() => { if(initMobileNav()) obs.disconnect(); });
      obs.observe(document.body, {childList:true, subtree:true});
    }
  });
})();
</script>


<!-- Conditionally loaded libraries: kept here so they stay centralized -->
<!-- Square: only inject on checkout page from main.js (see below) -->
<!-- Any analytics: include here once -->